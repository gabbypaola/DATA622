---
title: "DATA622 | Machine Learning and Big Data"
author: "Gabriella Martinez"
date: "5/14/2023"
output:
      html_document:
        toc: yes
        toc_float: yes
        theme: yeti
        highlight: kate
        font-family: "Arial"
        code_folding: show
---
# Final Project
**Exploratory analysis and essay**  

1. Choose a dataset. You get to decide which dataset you want to work on. The data set must be different from the ones used in previous homeworks You can work on a problem from your job, or something you are interested in. You may also obtain a dataset from sites such as Kaggle, Data.Gov, Census Bureau, USGS or other open data portals.   
2. Select one of the methodologies studied in weeks 1-10, and another methodology from weeks 11-15 to apply in the new dataset selected.  
3. To complete this task:  
    a. Describe the problem you are trying to solve.  
    b. Describe your datasets and what you did to prepare the data for analysis.  
    c. Methodologies you used for analyzing the data  
    d. What's the purpose of the analysis performed  
    e. Make your conclusions from your analysis. Please be sure to address the business impact (it could be of any domain) of your solution.  
  
**Deliverable**  

1. Your final presentation should incliude:    
    a. The traditional R file or Python file and essay  
    b. An Essay (minimum 500 word document) or Video (5 to 8 minutes recording). Include the execution and explanation of your code. The video can be recorded on any platform of your choice (Youtube, Free Cam).


# Packages
```{r message=FALSE, warning=FALSE}
library(readr)
library(tidyverse)
library(tidymodels)
library(psych)
library(caret)
library(rpart)
library(rpart.plot)
library(corrplot)
library(RColorBrewer)
library(labelled)
library(ggplot2)
library(ggforce)
library(pROC)
library(mlbench)
library(ModelMetrics)
library(randomForest)
library(e1071)
library(RSocrata)
library(Amelia)
```


# Load Data
```{r}
df_syr <- read.csv("https://raw.githubusercontent.com/gabbypaola/DATA622/main/Final/Summary_of_Syringe_Data_in_NYC_Parks.csv") 

df_pk <- read.csv("https://raw.githubusercontent.com/gabbypaola/DATA622/main/Final/Parks_Properties.csv")
```

# Exploratory Data Analysis

## Dimensions, Variable types, Labels, Levels, and Frequencies

From the below two functions, the dimensions of the dataset: 24651 rows, 23 columns. The variables read in do not contain any labels and as neither variable is a factor type, there are no factor levels to report. 

```{r}
glimpse(df_syr)

look_for(df_syr)

table(look_for(df_syr)$col_type)
```

```{r}
glimpse(df_pk)

table(look_for(df_pk)$col_type)
```

```{r}
df_pk<- df_pk %>% select(c("GISPROPNUM","ACRES","JURISDICTION","COMMUNITYBOARD",
                           "COUNCILDISTRICT","SUBCATEGORY","TYPECATEGORY",
                           "WATERFRONT"))

#first display numeric as non-scientific number, then convert to char, then trim whitespace
df_pk$COMMUNITYBOARD<-trimws(as.character(format(df_pk$COMMUNITYBOARD,scientific = FALSE)))
df_pk$COUNCILDISTRICT<-trimws(as.character(format(df_pk$COUNCILDISTRICT,scientific = FALSE)))

df_pk<-df_pk %>% 
  mutate(COMMUNITYBOARD = ifelse(nchar(df_pk$COMMUNITYBOARD)==3,
                                 df_pk$COMMUNITYBOARD,
                                 str_sub(gsub('(.{3})','\\1,',df_pk$COMMUNITYBOARD),end=-2)),
         COUNCILDISTRICT =  ifelse(nchar(df_pk$COUNCILDISTRICT)==2,
                                 df_pk$COUNCILDISTRICT,
                                 str_sub(gsub('(.{2})','\\1,',df_pk$COUNCILDISTRICT),end=-2)),
         ACRES = round(ACRES,2),
         WATERFRONT = as.logical(toupper(WATERFRONT))
         )
  
glimpse(df_pk)

#make factor?
df_pk %>% count(JURISDICTION) %>% arrange(-n)

df_pk %>% count(TYPECATEGORY) %>% arrange(-n)

df_pk %>% count(SUBCATEGORY) %>% arrange(-n)

names(df_pk) <- tolower(names(df_pk))
```

## Variable Dependencies and Definitions

Variable with dependency on two other variables in the dataset:  
`total_syringes` = `ground_syringes` + `kiosk_syringes`  

Variables that are a subset of one other variable:
`year`, `month`, `month_text`, `week`, `time_of_day`, `collected_date` are granular versions of the  `created_date` variable  

Since [this dataset](https://data.cityofnewyork.us/Public-Safety/Summary-of-Syringe-Data-in-NYC-Parks/t8xi-d5wb) was procured from the [Open NYC Data](https://opendata.cityofnewyork.us/), there is a [data dictionary](https://docs.google.com/spreadsheets/d/1VSUqd1peSc-4D2XnBZNiLdxa0Jg4z62D/edit#gid=1183788427) available for the variables.  

The [Parks Properties](https://data.cityofnewyork.us/Recreation/Parks-Properties/enfh-gkve) is also an Open NYC Data dataset which was brought in to gather additional data on the parks where syringes are collected. The [data dictionary](https://docs.google.com/spreadsheets/d/1Q4DBWu7riNFxWvy1vnTJHoOI3r2L9oW6eCN56jCNyCw/edit#gid=0) for the Parks Properties dataset in addition to the [user guide](https://docs.google.com/document/d/1NExNJF5YKID04oOopi0fHainRuGG3Pz_jKSrMujPsPk/edit) are available. The user guide is particularly useful for the detailed descriptions of the `TYPECATEGORY` variable not directly available on the data dictionary.

## Missing Data
```{r fig.align='center', fig.height=10, fig.width=10}
# str(df)

map(df_syr, ~sum(is.na(.))) %>% t()

missmap(df_syr, main = "Missing vs Observed Values")
```



<!------- Below is for removing excessive space in Rmarkdown | HTML formatting -------->

<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>